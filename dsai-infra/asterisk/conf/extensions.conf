[dsai]
exten => s,1,Answer()
 same => n,Ringing()
 same => n,Wait(1)
 same => n,Set(UUID=${SHELL(uuidgen | tr -d '\n')})
 same => n,Dial(AudioSocket/${ARG1}/${UUID})
 same => n,Hangup()

[demo]

exten => 5001,1,GoSub(dsai,s,1(dsai-core:5001))
exten => 5002,1,GoSub(dsai,s,1(host.docker.internal:5001))
; BEGIN number-9637c79a-c679-45c9-bd94-407fa7003b38
[demo]
exten => 3000,1,NoOp(Exten 3000 -> Agent agent1)
 same => n,Answer()
 same => n,Ringing()
 same => n,Wait(1)
 same => n,Set(AVR_NUMBER=${CALLERID(num)})
 same => n,Set(UUID=${SHELL(uuidgen | tr -d '\n')})
 same => n,Set(JSON_BODY={"uuid":"${UUID}","payload":{"from":"${CALLERID(num)}","to":"${EXTEN}","uniqueid":"${UNIQUEID}","channel":"${CHANNEL}","recording": false}})
 same => n,Set(CURLOPT(httpheader)=Content-Type: application/json)
 same => n,Set(JSON_RESPONSE=${CURL(http://dsai-core-2c17b84f-70ae-4dba-ac5e-1e1851471222:7485/call,${JSON_BODY})})
 same => n,NoOp(JSON_BODY: ${JSON_BODY})
 same => n,NoOp(JSON_RESPONSE: ${JSON_RESPONSE})
 same => n,GotoIf($["${JSON_RESPONSE}" = ""]?skip_http)
 same => n(skip_http),NoOp(HTTP call completed or skipped)
 same => n,Set(DENOISE(rx)=on)
 same => n,Dial(AudioSocket/dsai-core-2c17b84f-70ae-4dba-ac5e-1e1851471222:5623/${UUID})
 same => n,Hangup()
; END number-9637c79a-c679-45c9-bd94-407fa7003b38
; BEGIN number-1fee9f12-a22e-4eaf-bf65-5eda8baa8636
[demo]
exten => 4545,1,NoOp(Exten 4545 -> Agent test agent)
 same => n,Answer()
 same => n,Ringing()
 same => n,Wait(1)
 same => n,Set(AVR_NUMBER=${CALLERID(num)})
 same => n,Set(UUID=${SHELL(uuidgen | tr -d '\n')})
 same => n,Set(VICIDIAL_LEAD_ID=${PJSIP_HEADER(read,X-VICIdial-Lead-Id)})
 same => n,Set(VICIDIAL_CAMPAIGN_ID=${PJSIP_HEADER(read,X-VICIdial-Campaign-Id)})
 same => n,Set(VICIDIAL_PHONE=${PJSIP_HEADER(read,X-VICIdial-Phone-Number)})
 same => n,Set(VICIDIAL_USER=${PJSIP_HEADER(read,X-VICIdial-User-Id)})
 same => n,Set(VICIDIAL_LIST_ID=${PJSIP_HEADER(read,X-VICIdial-List-Id)})
 same => n,Set(JSON_BODY={"uuid":"${UUID}","payload":{"from":"${CALLERID(num)}","to":"${EXTEN}","uniqueid":"${UNIQUEID}","channel":"${CHANNEL}","recording":true,"vicidial":{"leadId":"${VICIDIAL_LEAD_ID}","campaignId":"${VICIDIAL_CAMPAIGN_ID}","phone":"${VICIDIAL_PHONE}","userId":"${VICIDIAL_USER}","listId":"${VICIDIAL_LIST_ID}"}}})
 same => n,Set(CURLOPT(httpheader)=Content-Type: application/json)
 same => n,Set(JSON_RESPONSE=${CURL(http://dsai-core-2da3e80c-0487-42fb-a36e-a6bac3c8a832:7267/call,${JSON_BODY})})
 same => n,NoOp(JSON_BODY: ${JSON_BODY})
 same => n,NoOp(JSON_RESPONSE: ${JSON_RESPONSE})
 same => n,GotoIf($["${JSON_RESPONSE}" = ""]?skip_http)
 same => n(skip_http),NoOp(HTTP call completed or skipped)
 same => n,MixMonitor(/var/spool/asterisk/monitor/demo/${UUID}.wav)
 same => n,Set(DENOISE(rx)=on)
 same => n,Dial(AudioSocket/dsai-core-2da3e80c-0487-42fb-a36e-a6bac3c8a832:5806/${UUID})
 same => n,Hangup()
; END number-1fee9f12-a22e-4eaf-bf65-5eda8baa8636
; BEGIN number-8f67fb98-dbd9-41b2-9ae5-6bf9c410468b
[demo]
exten => 4747,1,NoOp(Exten 4747 -> Agent agent 1)
 same => n,Answer()
 same => n,Ringing()
 same => n,Wait(1)
 same => n,Set(AVR_NUMBER=${CALLERID(num)})
 same => n,Set(UUID=${SHELL(uuidgen | tr -d '\n')})
 same => n,Set(VICIDIAL_LEAD_ID=${PJSIP_HEADER(read,X-VICIdial-Lead-Id)})
 same => n,Set(VICIDIAL_CAMPAIGN_ID=${PJSIP_HEADER(read,X-VICIdial-Campaign-Id)})
 same => n,Set(VICIDIAL_PHONE=${PJSIP_HEADER(read,X-VICIdial-Phone-Number)})
 same => n,Set(VICIDIAL_USER=${PJSIP_HEADER(read,X-VICIdial-User-Id)})
 same => n,Set(VICIDIAL_LIST_ID=${PJSIP_HEADER(read,X-VICIdial-List-Id)})
 same => n,Set(JSON_BODY={"uuid":"${UUID}","payload":{"from":"${CALLERID(num)}","to":"${EXTEN}","uniqueid":"${UNIQUEID}","channel":"${CHANNEL}","recording":true,"vicidial":{"leadId":"${VICIDIAL_LEAD_ID}","campaignId":"${VICIDIAL_CAMPAIGN_ID}","phone":"${VICIDIAL_PHONE}","userId":"${VICIDIAL_USER}","listId":"${VICIDIAL_LIST_ID}"}}})
 same => n,Set(CURLOPT(httpheader)=Content-Type: application/json)
 same => n,Set(JSON_RESPONSE=${CURL(http://dsai-core-d17647e1-4bd1-46f2-ab3c-c24d940914ef:7034/call,${JSON_BODY})})
 same => n,NoOp(JSON_BODY: ${JSON_BODY})
 same => n,NoOp(JSON_RESPONSE: ${JSON_RESPONSE})
 same => n,GotoIf($["${JSON_RESPONSE}" = ""]?skip_http)
 same => n(skip_http),NoOp(HTTP call completed or skipped)
 same => n,MixMonitor(/var/spool/asterisk/monitor/demo/${UUID}.wav)
 same => n,Set(DENOISE(rx)=on)
 same => n,Dial(AudioSocket/dsai-core-d17647e1-4bd1-46f2-ab3c-c24d940914ef:5475/${UUID})
 same => n,Hangup()
; END number-8f67fb98-dbd9-41b2-9ae5-6bf9c410468b
; BEGIN trunk-dialplan-19b9e594-fedd-4831-a756-a9b008caa313
[demo]
exten => _XXXXXXXXXX,1,NoOp(Outbound call via trunk dscarrier to ${EXTEN})
 same => n,Set(CALLERID(num)=+19196504455)
 same => n,Dial(PJSIP/${EXTEN}@19b9e594-fedd-4831-a756-a9b008caa313,60,Tt)
 same => n,Hangup()

exten => _1XXXXXXXXXX,1,NoOp(Outbound call via trunk dscarrier to ${EXTEN})
 same => n,Set(CALLERID(num)=+19196504455)
 same => n,Dial(PJSIP/${EXTEN}@19b9e594-fedd-4831-a756-a9b008caa313,60,Tt)
 same => n,Hangup()

exten => _+X.,1,NoOp(Outbound international call via trunk dscarrier to ${EXTEN})
 same => n,Set(CALLERID(num)=+19196504455)
 same => n,Dial(PJSIP/${EXTEN}@19b9e594-fedd-4831-a756-a9b008caa313,60,Tt)
 same => n,Hangup()
; END trunk-dialplan-19b9e594-fedd-4831-a756-a9b008caa313
