services:
  dsai-asterisk:
    image: agentvoiceresponse/dsai-asterisk
    platform: linux/x86_64
    container_name: dsai-asterisk
    restart: unless-stopped
    ports:
      - "5038:5038"    # AMI
      - "5060:5060"    # SIP
      - "9088:8088"    # ARI HTTP (mapped from 8088)
      - "9089:8089"    # ARI HTTPS/WebSocket WSS (mapped from 8089)
      - "9090:8090"    # WebSocket WS (mapped from 8090)
      - "10000-10050:10000-10050/udp"  # RTP
    volumes:
      - ./dsai-infra/asterisk/conf/manager.conf:/etc/asterisk/my_manager.conf
      - ./dsai-infra/asterisk/conf/pjsip.conf:/etc/asterisk/my_pjsip.conf
      - ./dsai-infra/asterisk/conf/extensions.conf:/etc/asterisk/my_extensions.conf
      - ./dsai-infra/asterisk/conf/queues.conf:/etc/asterisk/my_queues.conf
      - ./dsai-infra/asterisk/conf/ari.conf:/etc/asterisk/my_ari.conf
      - ./dsai-infra/asterisk/recordings:/var/spool/asterisk/monitor
    networks:
      - dsai
    environment:
      - ARI_USERNAME=asterisk
      - ARI_PASSWORD=asterisk

  dsai-ami:
    image: agentvoiceresponse/dsai-ami
    platform: linux/x86_64
    container_name: dsai-ami
    restart: unless-stopped
    environment:
      - PORT=6006
      - AMI_HOST=dsai-asterisk
      - AMI_PORT=5038
      - AMI_USERNAME=dsai
      - AMI_PASSWORD=dsai
    ports:
      - "6006:6006"
    networks:
      - dsai
    depends_on:
      - dsai-asterisk

  dsai-phone:
    build:
      context: ./dsai-phone
      dockerfile: Dockerfile
    platform: linux/x86_64
    container_name: dsai-phone
    restart: unless-stopped
    ports:
      - "9080:80"
    networks:
      - dsai
    environment:
      - NEXT_PUBLIC_SIP_SERVER=localhost:8089
      - NEXT_PUBLIC_SIP_USERNAME=1000
      - NEXT_PUBLIC_SIP_PASSWORD=1000

networks:
  dsai:
    name: dsai
    external: true
